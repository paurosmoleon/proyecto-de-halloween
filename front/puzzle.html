<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        *{
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
    
        .tablero{
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 4px;
            width: 310px;
            margin: 120px auto;
        }
        .ficha{
            background-color: #f3ea60;
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            cursor: pointer;
            border-radius: 4px;
            box-shadow: 3px 3px #b96453;
        }
    </style>
</head>
<body>
    <div class="tablero"></div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
let matriz =  mezclarMatriz()
let tablero = document.querySelector('.tablero')
dibujarFichas()
addEventListeners()

function dibujarFichas(){
    tablero.innerHTML='';
    matriz.forEach(fila => fila.forEach(elemento =>{
        if(elemento ==''){
            tablero.innerHTML += `<div class="empty">${elemento}</div`
        }else{
        tablero.innerHTML += `<div class="ficha">${elemento}</div`
        }
    }))
}
function addEventListeners(){
    let fichas = document.querySelectorAll('.ficha')
    fichas.forEach(ficha => ficha.addEventListener('click',()=>{
       let poscionActual = buscarPosicion(ficha.innerText)
       let posicionEmpty = buscarPosicion('')
       let movimiento = sePuedeMover(poscionActual,posicionEmpty)

       if(movimiento !==false){
        actualizarMatriz(ficha.innerText,poscionActual, posicionEmpty)
        
        let resultado = compararMatriz()
        if (resultado === true){
            confetti({
                particleCount: 200,
                spread: 180
            })
        }        
        dibujarFichas()
        addEventListeners()
       }

    }))
}
function buscarPosicion(elemento){
let filaIndex = 0;
let columnaIndex = 0;
    matriz.forEach((fila,index) =>{
        let filaELemento = fila.findIndex(item => item == elemento)
        if(filaELemento !== -1){
            filaIndex = index;
            columnaIndex = filaELemento;
        }
    })
    return [filaIndex, columnaIndex]
}
function sePuedeMover(poscionActual,posicionEmpty){
  if(poscionActual[1] == posicionEmpty[1]){
    if(poscionActual[0]-posicionEmpty[0] >1 || poscionActual[0]-posicionEmpty[0] <-1){
        return false
    }
  }else if(poscionActual[0] == posicionEmpty[0]){ 
    if(poscionActual[1]-posicionEmpty[1] >1 || poscionActual[1]-posicionEmpty[1] <-1){ 
        return false
    }
  }else{
     return false
  }
} 
function actualizarMatriz(elemento,poscionActual, posicionEmpty){
    matriz[poscionActual[0]][poscionActual[1]] = ''
    matriz[posicionEmpty[0]][posicionEmpty[1]] = elemento

}
function mezclarMatriz(){
        let matrizMezclada = [
        [],
        [],
        []
        ]
        let array = ['1','2','3','4','5','6','7','8','']
        let mezclarArray = array.sort(()=>Math.random()-0.5)
        let columna = 0;
        let fila = 0;
        mezclarArray.forEach(elemento =>{
            matrizMezclada[fila].push(elemento)
            if(columna <2){
                columna++;
            }else{
                columna = 0;
                fila++
            }
        })
        return matrizMezclada
}    
function compararMatriz(){
    let contador = 0
    let matrizFinal = [
        ['1', '2', '3'],
        ['4', '5', '6'],
        ['7', '8', '']
    ]

    matriz.forEach((fila, filaIndex) => {
        fila.forEach((elemento, columnaIndex) => {
            if (elemento == matrizFinal[filaIndex][columnaIndex]) {
                contador++
            }
        })
    })
    console.log(contador)
    if (contador == 9){
        return true
    }else{
        return false
    } 
}


</script>
</body>
</html>